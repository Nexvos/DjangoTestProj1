{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load mathfilters %}


{% block head_title %}Betting | {{ block.super }}{% endblock %}

<style>
{% block style %}

.thumbnail{
    height: 95%;
    width: 100%;
}
svg {
	display: block;
    margin: auto;
}
{% endblock %}
</style>

{% block extracss %}
    {% load static %}

    <link rel="stylesheet" type="text/css" href="{% static 'userbetting/style.css' %}" />
    <meta charset="UTF-8">
    <script src="{% static 'userbetting/miniPie.js' %}"></script>
{% endblock %}

{% block jumbotron %}
{#    {% ifnotequal query 'None' %}#}
{#<div class="jumbotron" style="padding-bottom: 30px;">#}
{#    <div class="container home-wide">#}
{#        <div class="row" style="border-bottom: 2px solid #c3c3c3; margin-bottom: 15px;">#}
{#            <div class="col-md-12">#}
{#                <p class='display-4 text-align-left' style="margin-bottom: 0;">{{ query }} </p>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#    {% endifnotequal %}#}

{#airplane#}
<script src="{% static 'js/d3.js' %}"></script>


{#<script src="http://d3js.org/d3.v3.min.js"></script>#}


{% endblock %}

{% block content %}
    <h4 class="display-4 betting-title rounded" style="font-size: 3rem;font-weight: 500;">Tournaments<a style="font-size: 1rem;" href="{% url "userBetting:tournament_list_view" %}"><strong><< View all tournaments >></strong></a></h4>
    <div class="row" style="margin-right: 0px; margin-left: 0px;">
        <div class="col-sm-4" style="padding-top: 15px; padding-bottom: 15px;">
        <div class="card" style="border: 1px solid #b5b5b5;">
          <h5 class="card-header">Upcoming*</h5>
          <div class="card-body" {% if upcoming_tournaments %}style="padding: 0;" {% endif %}>
            {% if upcoming_tournaments %}
            <div class="list-group">
                {% for tournament in upcoming_tournaments %}

                        <a class="list-group-item list-group-item-action list-group-item-dark" href="{% url 'userBetting:tournament_view' tournament.tournament_id %}">
                            {{ tournament.tournament_name }}
                        </a>

                {% endfor %}
            </div>
            {% else %}
                <p class="card-text"> No upcoming tournaments. </p>
            {% endif %}
          </div>
        </div>
        </div>

        <div class="col-sm-8" style="padding-top: 15px; padding-bottom: 15px;">


        <div class="card" style="border: 1px solid #b5b5b5;">
          <h5 class="card-header">Ongoing*</h5>
          <div class="card-body" {% if ongoing_tournaments %}style="padding: 0;" {% endif %}>
            {% if ongoing_tournaments %}
            <div class="row" style="margin-right: 0px; margin-left: 0px;">
                <div class="col-sm-6" style="padding: 0px;">
                    <div class="list-group">
                        {% for tournament in ongoing_tournaments|slice:":4" %}
                            <a
                                    class="list-group-item list-group-item-action list-group-item-dark"
                                    href="{% url 'userBetting:tournament_view' tournament.tournament_id %}"
                                    style="background-color:#{{ tournament.videogame.colour }};"
                                    onmouseover="this.style.backgroundColor='#{{ tournament.videogame.alt_colour }}'"
                                    onmouseout="this.style.backgroundColor='#{{ tournament.videogame.colour }}'"
                            >
                                <img src="{{ tournament.videogame.picture.url }}" style="height: 100%"> &nbsp; {{ tournament.tournament_name }}
                            </a>

                        {% endfor %}
                    </div>
                </div>
                <div class="col-sm-6" style="padding: 0px;">
                    <div class="list-group">
                        {% for tournament in ongoing_tournaments|slice:"4:" %}

                            <a
                                    class="list-group-item list-group-item-action list-group-item-dark"
                                    href="{% url 'userBetting:tournament_view' tournament.tournament_id %}"
                                    style="background-color:#{{ tournament.videogame.colour }};"
                                    onmouseover="this.style.backgroundColor='#{{ tournament.videogame.alt_colour }}'"
                                    onmouseout="this.style.backgroundColor='#{{ tournament.videogame.colour }}'"
                            >
                                <img src="{{ tournament.videogame.picture.url }}" style="height: 100%"> &nbsp; {{ tournament.tournament_name }}
                            </a>

                        {% endfor %}
                    </div>
                </div>
            </div>
            {% else %}
                <p class="card-text"> No ongoing tournaments. </p>
            {% endif %}
          </div>
        </div>



        </div>

{#        <div class="col-sm-4" style="padding-top: 15px; padding-bottom: 15px;">#}
{#        <div class="card" style="border: 1px solid #b5b5b5;">#}
{#          <h5 class="card-header">Completed</h5>#}
{#          <div class="card-body" {% if completed_tournaments %}style="padding: 0;" {% endif %}>#}
{#            {% if completed_tournaments %}#}
{#            <div class="list-group">#}
{#                {% for tournament in completed_tournaments %}#}
{##}
{#                        <a class="list-group-item list-group-item-action list-group-item-dark" href="{% url 'userBetting:tournament_view' tournament.tournament_id %}">#}
{#                            {{ tournament.tournament_name }}#}
{#                        </a>#}
{##}
{#                {% endfor %}#}
{#            </div>#}
{#            {% else %}#}
{#                <p class="card-text">No tournaments completed in the last 3 months.</p>#}
{#            {% endif %}#}
{#          </div>#}
{#        </div>#}
{#        </div>#}
    </div>

    <h4 class="display-4 betting-title rounded align-items-center" style="font-size: 3rem;font-weight: 500;">Latest Games</h4>
    <br>
    {% if latest_game_list %}
        <div id="games_list" class="row grid-view">
            {% include 'userbetting/games_list.html' %}
        </div>
        <div>
            <button class= "btn btn-primary btn-lg btn-block" id="lazyLoadLink" data-page=2>Load more</button>
        </div>
        <br>
    {% else %}
        <p>No games are available at this time.</p>
    {% endif %}

<script>


// needed when making post requests in Django
// weâ€™ll use this for the ajax request in script.js
window.CSRF_TOKEN = "{{ csrf_token }}";

$('#lazyLoadLink').on('click', function() {
    console.log("working?");
    var link = $(this);
    var page = link.data("page");
    console.log(page)
    $.ajax({
      type: 'post',
      url: '{% url 'userBetting:lazy_load_posts' %}',
      data: {
        'page': page,
        'csrfmiddlewaretoken': window.CSRF_TOKEN // from index.html
      },
      success: function(data) {
        // if there are still more pages to load,
        // add 1 to the "Load More Posts" link's page data attribute
        // else hide the link
        console.log("Dat re");
        if (data.has_next) {
            link.data('page', page+1);
        } else {
            link.hide();
        };
        // append html to the posts div

        $('#games_list').append(data.games_list_html);
      },
      error: function(xhr, status, error) {
        // shit happens friends!
      }
    });
  });
</script>
<style>

.thumbnail
{
    margin-bottom: 20px;
    padding: 0px;
    -webkit-border-radius: 0px;
    -moz-border-radius: 0px;
    border-radius: 0px;
    background-color: #fff;
    border: 1px solid #b5b5b5;
}
.thumbnail img{
    max-width: 100%;
}
.item.list-group-item .list-group-image
{
    margin-right: 10px;
}
.item.list-group-item .thumbnail
{
    margin-bottom: 0px;
}
.item.list-group-item .caption
{
    padding: 9px 9px 0px 9px;
}


.item.list-group-item img
{
    float: left;
}

.list-group-item-text
{
    margin: 0 0 11px;
}
.caption{
    padding: 8px;
}

</style>

{% endblock %}