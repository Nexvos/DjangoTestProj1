{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load mathfilters %}


{% block head_title %}Betting | {{ block.super }}{% endblock %}


<style>
{% block style %}
.navbar-static-top {
	margin-bottom: 0px !important;
}
.jumbotron {
	background-color:#f6f6f6;
	color: #000000;
}
{% endblock %}
</style>


{% block extracss %}
    {% load static %}

    <link rel="stylesheet" type="text/css" href="{% static 'userbetting/style.css' %}" />
    <meta charset="UTF-8">
    <script src="{% static 'userbetting/miniPie.js' %}"></script>
{% endblock %}

{% block jumbotron %}
<div class="jumbotron">
    <div class="container">
    <div class="row">
    <div class="col-md-8 col-md-offset-1">
        <div class="widget">
            <div class="h3">{{ query }}</div>
            <div id="chart" class="chart-container"></div>
        </div>
    </div>

</div>
</div>
</div>

<script src="http://d3js.org/d3.v3.min.js"></script>


{% endblock %}

{% block content %}
    {% if latest_game_list %}
        <div id="products" class="row grid-view">
            {% for game in latest_game_list %}
            <div class="item  col-xs-4 col-lg-4">
                <div class="thumbnail">
                    <div class="widget" style="padding-top: 10px;">
                        <div id="chart{{ forloop.counter }}" class="chart-container"></div>
                    </div>
                    <div class="caption">
                        <h4 class="group inner list-group-item-heading" style="margin-top: 0.5rem;"><a href="{% url 'userBetting:detail' game.game_id %}">
                            {{ game.team_a }} vs {{ game.team_b }}</a></h4>


                            <p class="group inner list-group-item-text" style="margin-top: 5px">
                        {{ game.game_date|date:"d-F Y H:i" }}
                            </p>

                        <div class="row">

                            <div class="col-xs-12 col-md-6">
                                <p class="lead font-weight-bold" style="color:green;">
                                    {{ game.status }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
            // Create the team data
            var dataset = [
            {% for bet in game.bet_set.all %}
                {
                name:'{{ bet.user }}',
                amount:{{ bet.amount }},
                percent: 50,
                team:'{{ bet.chosen_team }}',
                colour:'#{{ bet.user.profile.colour }}'
                },
            {% endfor %}
            ];

            var teamdata_a_amount = 0;
            var teamdata_b_amount = 0;

            if (dataset === undefined || dataset.length == 0){
                teamdata_a_amount = 1;
                teamdata_b_amount = 1;
            }
            else{
                for (i in dataset){
                   if (dataset[i].team=='{{ game.team_a }}') {
                       teamdata_a_amount += dataset[i].amount;
                   }
                   else if(dataset[i].team=='{{ game.team_b }}'){
                       teamdata_b_amount += dataset[i].amount;
                   }
                };
            };

            var total_ab_amount = teamdata_a_amount + teamdata_b_amount;
            var teamdata_a_percent = (teamdata_a_amount / total_ab_amount) * 100;
            var teamdata_b_percent = (teamdata_b_amount / total_ab_amount) * 100;

            var team_dataset = [
                {
                name:'{{ game.team_b }}',
                amount:teamdata_b_amount,
                percent: teamdata_b_percent,
                team:'{{ game.team_b }}',
                colour:'#{{ game.team_b.colour }}'
            },
            {
                name:'{{ game.team_a }}',
                amount:teamdata_a_amount,
                percent: teamdata_a_percent,
                team:'{{ game.team_a }}',
                colour:'#{{ game.team_a.colour }}'
                }];

            InitialPie(team_dataset, {{ forloop.counter }});


            </script>
            {% endfor %}
        </div>
    {% else %}
        <p>No games are available at this time.</p>
    {% endif %}

<style>

.thumbnail
{
    margin-bottom: 20px;
    padding: 0px;
    -webkit-border-radius: 0px;
    -moz-border-radius: 0px;
    border-radius: 0px;
    background-color: #fff;
    border: 1px solid #ddd;
}
.thumbnail img{
    max-width: 100%;
}
.item.list-group-item .list-group-image
{
    margin-right: 10px;
}
.item.list-group-item .thumbnail
{
    margin-bottom: 0px;
}
.item.list-group-item .caption
{
    padding: 9px 9px 0px 9px;
}


.item.list-group-item img
{
    float: left;
}

.list-group-item-text
{
    margin: 0 0 11px;
}
.caption{
    padding: 8px;
}

</style>

{% endblock %}